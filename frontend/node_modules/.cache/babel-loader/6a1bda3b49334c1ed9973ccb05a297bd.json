{"ast":null,"code":"var _jsxFileName = \"/Users/leyaozhou/Around/frontend/src/components/AroundMap.js\";\nimport React, { Component } from 'react';\nimport { POS_KEY } from '../constants';\nimport { withScripts, withGoogleMap, GoogleMap, withScriptjs } from 'react-google-maps';\nimport AroundMarker from './AroundMarker';\n\nclass NormalAroundMap extends Component {\n  constructor(...args) {\n    super(...args);\n\n    this.getMapRef = mapInstance => {\n      this.map = mapInstance;\n      window.map = mapInstance;\n    };\n\n    this.reloadMarker = () => {\n      const center = this.getCenter();\n      const radius = this.getRadius();\n      console.log(radius);\n      this.props.loadPostsByTopic(center, radius);\n    };\n  }\n\n  getCenter() {\n    const center = this.map.getCenter();\n    return {\n      lat: center.lat(),\n      lon: center.lng()\n    };\n  }\n\n  getRadius() {\n    const center = this.map.getCenter();\n    const bounds = this.map.getBounds();\n\n    if (center && bounds) {\n      const ne = bounds.getNorthEast();\n      const right = new window.google.maps.LatLng(center.lat(), ne.lng());\n      return 0.001 * window.google.maps.geometry.spherical.computeDistanceBetween(center, right);\n    }\n  }\n\n  render() {\n    const {\n      lat,\n      lon\n    } = JSON.parse(localStorage.getItem(POS_KEY));\n    return /*#__PURE__*/React.createElement(GoogleMap, {\n      ref: this.getMapRef,\n      defaultZoom: 11,\n      defaultCenter: {\n        lat,\n        lng: lon\n      },\n      onDragEnd: this.reloadMarker,\n      onZoomChanged: this.reloadMarker,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 13\n      }\n    }, this.props.posts.map(post => /*#__PURE__*/React.createElement(AroundMarker, {\n      post: post,\n      key: post.url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 53\n      }\n    })));\n  }\n\n}\n\nconst AroundMap = withScriptjs(withGoogleMap(NormalAroundMap));\nexport default AroundMap;","map":{"version":3,"sources":["/Users/leyaozhou/Around/frontend/src/components/AroundMap.js"],"names":["React","Component","POS_KEY","withScripts","withGoogleMap","GoogleMap","withScriptjs","AroundMarker","NormalAroundMap","getMapRef","mapInstance","map","window","reloadMarker","center","getCenter","radius","getRadius","console","log","props","loadPostsByTopic","lat","lon","lng","bounds","getBounds","ne","getNorthEast","right","google","maps","LatLng","geometry","spherical","computeDistanceBetween","render","JSON","parse","localStorage","getItem","posts","post","url","AroundMap"],"mappings":";AAAA,OAAOA,KAAP,IAAeC,SAAf,QAA+B,OAA/B;AACA,SAAQC,OAAR,QAAsB,cAAtB;AAEA,SACIC,WADJ,EAEIC,aAFJ,EAGIC,SAHJ,EAIIC,YAJJ,QAKO,mBALP;AAOA,OAAOC,YAAP,MAAyB,gBAAzB;;AAEA,MAAMC,eAAN,SAA8BP,SAA9B,CAAwC;AAAA;AAAA;;AAAA,SACpCQ,SADoC,GACvBC,WAAD,IAAiB;AACzB,WAAKC,GAAL,GAAWD,WAAX;AACAE,MAAAA,MAAM,CAACD,GAAP,GAAaD,WAAb;AACH,KAJmC;;AAAA,SAMpCG,YANoC,GAMrB,MAAM;AACjB,YAAMC,MAAM,GAAG,KAAKC,SAAL,EAAf;AACA,YAAMC,MAAM,GAAG,KAAKC,SAAL,EAAf;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYH,MAAZ;AACA,WAAKI,KAAL,CAAWC,gBAAX,CAA4BP,MAA5B,EAAoCE,MAApC;AACH,KAXmC;AAAA;;AAapCD,EAAAA,SAAS,GAAG;AACR,UAAMD,MAAM,GAAG,KAAKH,GAAL,CAASI,SAAT,EAAf;AACA,WAAO;AAACO,MAAAA,GAAG,EAAER,MAAM,CAACQ,GAAP,EAAN;AAAoBC,MAAAA,GAAG,EAAET,MAAM,CAACU,GAAP;AAAzB,KAAP;AACH;;AAEDP,EAAAA,SAAS,GAAG;AACR,UAAMH,MAAM,GAAG,KAAKH,GAAL,CAASI,SAAT,EAAf;AACA,UAAMU,MAAM,GAAG,KAAKd,GAAL,CAASe,SAAT,EAAf;;AACA,QAAIZ,MAAM,IAAIW,MAAd,EAAsB;AAClB,YAAME,EAAE,GAAGF,MAAM,CAACG,YAAP,EAAX;AACA,YAAMC,KAAK,GAAG,IAAIjB,MAAM,CAACkB,MAAP,CAAcC,IAAd,CAAmBC,MAAvB,CAA8BlB,MAAM,CAACQ,GAAP,EAA9B,EAA4CK,EAAE,CAACH,GAAH,EAA5C,CAAd;AACA,aAAO,QAAQZ,MAAM,CAACkB,MAAP,CAAcC,IAAd,CAAmBE,QAAnB,CAA4BC,SAA5B,CAAsCC,sBAAtC,CAA6DrB,MAA7D,EAAqEe,KAArE,CAAf;AACH;AACJ;;AAEDO,EAAAA,MAAM,GAAG;AACL,UAAM;AAACd,MAAAA,GAAD;AAAMC,MAAAA;AAAN,QAAac,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqBtC,OAArB,CAAX,CAAnB;AACA,wBACI,oBAAC,SAAD;AACI,MAAA,GAAG,EAAE,KAAKO,SADd;AAEI,MAAA,WAAW,EAAE,EAFjB;AAGI,MAAA,aAAa,EAAE;AAACa,QAAAA,GAAD;AAAME,QAAAA,GAAG,EAAED;AAAX,OAHnB;AAII,MAAA,SAAS,EAAE,KAAKV,YAJpB;AAKI,MAAA,aAAa,EAAE,KAAKA,YALxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAMS,KAAKO,KAAL,CAAWqB,KAAX,CAAiB9B,GAAjB,CAAsB+B,IAAD,iBAAU,oBAAC,YAAD;AAAc,MAAA,IAAI,EAAEA,IAApB;AAA0B,MAAA,GAAG,EAAEA,IAAI,CAACC,GAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAA/B,CANT,CADJ;AAUH;;AAxCmC;;AA2CxC,MAAMC,SAAS,GAAGtC,YAAY,CAACF,aAAa,CAACI,eAAD,CAAd,CAA9B;AAEA,eAAeoC,SAAf","sourcesContent":["import React, {Component} from 'react';\nimport {POS_KEY} from '../constants';\n\nimport {\n    withScripts,\n    withGoogleMap,\n    GoogleMap,\n    withScriptjs,\n} from 'react-google-maps';\n\nimport AroundMarker from './AroundMarker';\n\nclass NormalAroundMap extends Component {\n    getMapRef = (mapInstance) => {\n        this.map = mapInstance;\n        window.map = mapInstance;\n    }\n\n    reloadMarker = () => {\n        const center = this.getCenter();\n        const radius = this.getRadius();\n        console.log(radius);\n        this.props.loadPostsByTopic(center, radius);\n    }\n\n    getCenter() {\n        const center = this.map.getCenter();\n        return {lat: center.lat(), lon: center.lng()};\n    }\n\n    getRadius() {\n        const center = this.map.getCenter();\n        const bounds = this.map.getBounds();\n        if (center && bounds) {\n            const ne = bounds.getNorthEast();\n            const right = new window.google.maps.LatLng(center.lat(), ne.lng());\n            return 0.001 * window.google.maps.geometry.spherical.computeDistanceBetween(center, right);\n        }\n    }\n\n    render() {\n        const {lat, lon} = JSON.parse(localStorage.getItem(POS_KEY));\n        return (\n            <GoogleMap\n                ref={this.getMapRef}\n                defaultZoom={11}\n                defaultCenter={{lat, lng: lon}}\n                onDragEnd={this.reloadMarker}\n                onZoomChanged={this.reloadMarker}>\n                    {this.props.posts.map((post) => <AroundMarker post={post} key={post.url}/>)}\n            </GoogleMap>\n        );\n    }\n}\n\nconst AroundMap = withScriptjs(withGoogleMap(NormalAroundMap));\n\nexport default AroundMap;"]},"metadata":{},"sourceType":"module"}